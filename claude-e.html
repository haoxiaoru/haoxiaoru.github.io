<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>和弦详解 | 音乐理论基础</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --background-color: #f9f9f9;
            --text-color: #333;
            --light-gray: #ecf0f1;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background-color: white;
            padding: 2rem 1rem;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            border-right: 1px solid var(--light-gray);
            display: none;
        }
        
        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1100px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-gray);
        }
        
        h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 2.5rem 0 1rem;
            padding-top: 0.5rem;
        }
        
        h3 {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 1.8rem 0 1rem;
            color: var(--primary-color);
        }
        
        p {
            margin-bottom: 1.2rem;
            font-size: 1.05rem;
        }
        
        .toc {
            list-style: none;
            padding: 0;
        }
        
        .toc a {
            display: block;
            text-decoration: none;
            color: var(--primary-color);
            padding: 0.5rem;
            margin-bottom: 0.2rem;
            border-radius: var(--border-radius);
            transition: background-color 0.2s;
        }
        
        .toc a:hover {
            background-color: var(--light-gray);
        }
        
        .toc li.active a {
            background-color: var(--light-gray);
            font-weight: 500;
        }
        
        .toc .toc-sub {
            padding-left: 1rem;
            font-size: 0.95rem;
        }
        
        .chord-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: var(--box-shadow);
        }
        
        .chord-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .chart-container {
            height: 400px;
            margin: 2rem 0;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--box-shadow);
        }
        
        .piano {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            height: 120px;
            position: relative;
            user-select: none;
        }
        
        .piano-key {
            height: 100%;
            position: relative;
            cursor: pointer;
        }
        
        .piano-key.white {
            width: 45px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 0 0 4px 4px;
            z-index: 1;
        }
        
        .piano-key.black {
            width: 30px;
            background-color: #333;
            margin: 0 -15px;
            height: 65%;
            z-index: 2;
            border-radius: 0 0 4px 4px;
        }
        
        .piano-key.active {
            background-color: var(--secondary-color);
        }
        
        .piano-key.highlight {
            background-color: var(--accent-color);
        }
        
        .key-label {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 500;
            color: black;
        }
        
        .black .key-label {
            color: white;
            bottom: 5px;
        }
        
        .quiz-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: var(--box-shadow);
        }
        
        .quiz-options {
            list-style: none;
            margin: 1rem 0;
        }
        
        .quiz-option {
            padding: 0.8rem 1rem;
            margin-bottom: 0.8rem;
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .quiz-option:hover {
            background-color: #e0e6e9;
        }
        
        .quiz-option.correct {
            background-color: #a3e4d7;
        }
        
        .quiz-option.incorrect {
            background-color: #f9d5d3;
        }
        
        .quiz-feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: var(--border-radius);
            display: none;
        }
        
        .quiz-feedback.correct {
            background-color: #d5f5e3;
            display: block;
        }
        
        .quiz-feedback.incorrect {
            background-color: #fadbd8;
            display: block;
        }
        
        figure {
            margin: 2rem 0;
            text-align: center;
        }
        
        figcaption {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }
        
        img {
            max-width: 100%;
            border-radius: var(--border-radius);
        }
        
        @media (min-width: 1024px) {
            .sidebar {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 1.5rem;
            }
            
            .chord-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            h3 {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 侧边栏导航 -->
        <aside class="sidebar">
            <h2 style="font-size: 1.4rem; margin: 0 0 1.5rem 0;">目录</h2>
            <ul class="toc" id="toc">
                <li><a href="#introduction">和弦简介</a></li>
                <li><a href="#chord-structure">和弦的结构</a></li>
                <li><a href="#triad-types">三和弦类型</a>
                    <ul class="toc-sub">
                        <li><a href="#major-triad">大三和弦</a></li>
                        <li><a href="#minor-triad">小三和弦</a></li>
                        <li><a href="#diminished-triad">减三和弦</a></li>
                        <li><a href="#augmented-triad">增三和弦</a></li>
                    </ul>
                </li>
                <li><a href="#seventh-chords">七和弦</a>
                    <ul class="toc-sub">
                        <li><a href="#major-seventh">大七和弦</a></li>
                        <li><a href="#dominant-seventh">属七和弦</a></li>
                        <li><a href="#minor-seventh">小七和弦</a></li>
                        <li><a href="#half-diminished">半减七和弦</a></li>
                        <li><a href="#diminished-seventh">减七和弦</a></li>
                    </ul>
                </li>
                <li><a href="#extended-chords">扩展和弦</a></li>
                <li><a href="#special-chords">特殊和弦</a></li>
                <li><a href="#chord-progressions">和弦进行</a></li>
                <li><a href="#quiz">和弦小测验</a></li>
            </ul>
        </aside>

        <!-- 主要内容 -->
        <div class="main-content">
            <h1>和弦：音乐的构建模块</h1>

            <section id="introduction">
                <h2>和弦简介</h2>
                <p>和弦是音乐理论中的基本概念，指的是三个或更多音符的同时发声，形成一个和谐的整体。和弦是现代音乐的骨架，为旋律提供和声支持，塑造音乐的情感色彩和风格特点。</p>
                
                <p>从本质上讲，和弦是根据特定音程关系构建起来的音的集合。这些音之间的相对关系创造出不同的和声色彩，从明亮欢快的大和弦，到忧郁的小和弦，再到紧张的增和弦。</p>
                
                <figure>
                    <img src="https://kimi-image-search.app.msh.team/?q=piano%20chord%20harmony%20music" alt="钢琴和弦示意图" width="600">
                    <figcaption>钢琴上的和弦是多个琴键同时按下产生的和谐音响</figcaption>
                </figure>
            </section>

            <section id="chord-structure">
                <h2>和弦的结构</h2>
                
                <p>和弦由一个根音和在此之上按特定音程关系堆叠的音组成。最基本的和弦是三和弦，包含三个音：</p>
                
                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                    <li><strong>根音（Root）</strong>：和弦的基础音，也是和弦名称的来源</li>
                    <li><strong>三音（Third）</strong>：根音上方的第三个音级</li>
                    <li><strong>五音（Fifth）</strong>：根音上方的第五个音级</li>
                </ul>
                
                <p>例如，C大三和弦由根音C，三音E和五音G组成。这些音程关系决定了和弦的类型和特性。</p>
                
                <div class="chart-container" id="chord-structure-chart"></div>
            </section>

            <section id="triad-types">
                <h2>三和弦类型</h2>
                <p>三和弦是最基础的和弦类型，由根音、三音和五音组成。根据三音和五音与根音之间的音程关系，三和弦可以分为四种基本类型：</p>
                
                <div class="chord-grid">
                    <div class="chord-card" id="major-triad">
                        <h3>大三和弦</h3>
                        <p>大三和弦（Major Triad）是最基础、最常见的和弦类型，由根音、大三度和纯五度组成。</p>
                        <p>结构：<strong>根音 + 大三度（4个半音） + 纯五度（7个半音）</strong></p>
                        <p>音响特点：明亮、稳定、欢快</p>
                        <p>示例：C大三和弦（C-E-G）</p>
                    </div>
                    
                    <div class="chord-card" id="minor-triad">
                        <h3>小三和弦</h3>
                        <p>小三和弦（Minor Triad）与大三和弦的区别在于三音降低半音，形成小三度。</p>
                        <p>结构：<strong>根音 + 小三度（3个半音） + 纯五度（7个半音）</strong></p>
                        <p>音响特点：暗沉、忧郁、柔和</p>
                        <p>示例：C小三和弦（C-Eb-G）</p>
                    </div>
                    
                    <div class="chord-card" id="diminished-triad">
                        <h3>减三和弦</h3>
                        <p>减三和弦（Diminished Triad）具有小三度和减五度的结构。</p>
                        <p>结构：<strong>根音 + 小三度（3个半音） + 减五度（6个半音）</strong></p>
                        <p>音响特点：紧张、不稳定、神秘</p>
                        <p>示例：C减三和弦（C-Eb-Gb）</p>
                    </div>
                    
                    <div class="chord-card" id="augmented-triad">
                        <h3>增三和弦</h3>
                        <p>增三和弦（Augmented Triad）由大三度和增五度构成。</p>
                        <p>结构：<strong>根音 + 大三度（4个半音） + 增五度（8个半音）</strong></p>
                        <p>音响特点：不稳定、紧张感、戏剧性</p>
                        <p>示例：C增三和弦（C-E-G#）</p>
                    </div>
                </div>
                
                <div class="piano" id="triad-piano">
                    <!-- 钢琴键盘将通过js动态生成 -->
                </div>
                
                <div class="chart-container" id="triad-comparison-chart"></div>
            </section>

            <section id="seventh-chords">
                <h2>七和弦</h2>
                <p>七和弦是在三和弦基础上，再加上一个在根音上方七度的音形成的四音和弦。七和弦增加了和弦的复杂性和表现力。以下是最常见的几种七和弦：</p>
                
                <div class="chord-grid">
                    <div class="chord-card" id="major-seventh">
                        <h3>大七和弦</h3>
                        <p>大七和弦（Major Seventh）由大三和弦加上大七度音构成。</p>
                        <p>结构：<strong>大三和弦 + 大七度</strong></p>
                        <p>音响特点：温暖、圆润、带有一定的张力</p>
                        <p>示例：CMaj7（C-E-G-B）</p>
                    </div>
                    
                    <div class="chord-card" id="dominant-seventh">
                        <h3>属七和弦</h3>
                        <p>属七和弦（Dominant Seventh）由大三和弦加上小七度音构成，是最常见的七和弦。</p>
                        <p>结构：<strong>大三和弦 + 小七度</strong></p>
                        <p>音响特点：不稳定、有很强的解决倾向</p>
                        <p>示例：C7（C-E-G-Bb）</p>
                    </div>
                    
                    <div class="chord-card" id="minor-seventh">
                        <h3>小七和弦</h3>
                        <p>小七和弦（Minor Seventh）由小三和弦加上小七度音构成。</p>
                        <p>结构：<strong>小三和弦 + 小七度</strong></p>
                        <p>音响特点：柔和、忧郁、圆润</p>
                        <p>示例：Cm7（C-Eb-G-Bb）</p>
                    </div>
                    
                    <div class="chord-card" id="half-diminished">
                        <h3>半减七和弦</h3>
                        <p>半减七和弦（Half-diminished Seventh）由减三和弦加上小七度音构成。</p>
                        <p>结构：<strong>减三和弦 + 小七度</strong></p>
                        <p>音响特点：忧郁、不稳定、过渡性</p>
                        <p>示例：Cø7（C-Eb-Gb-Bb）</p>
                    </div>
                    
                    <div class="chord-card" id="diminished-seventh">
                        <h3>减七和弦</h3>
                        <p>减七和弦（Diminished Seventh）由减三和弦加上减七度音构成。</p>
                        <p>结构：<strong>减三和弦 + 减七度</strong></p>
                        <p>音响特点：极度不稳定、强烈紧张感</p>
                        <p>示例：C°7（C-Eb-Gb-A）</p>
                    </div>
                </div>
                
                <div class="chart-container" id="seventh-chord-chart"></div>
            </section>

            <section id="extended-chords">
                <h2>扩展和弦</h2>
                <p>扩展和弦是指在七和弦的基础上，继续按照三度关系添加音符形成的和弦，包括九和弦、十一和弦和十三和弦。这些和弦在爵士、流行和现代古典音乐中广泛使用，能提供更丰富的和声色彩。</p>
                
                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                    <li><strong>九和弦（9th Chords）</strong>：在七和弦基础上加入九度音，例如CMaj9（C-E-G-B-D）</li>
                    <li><strong>十一和弦（11th Chords）</strong>：在九和弦基础上加入十一度音，例如C11（C-E-G-Bb-D-F）</li>
                    <li><strong>十三和弦（13th Chords）</strong>：在十一和弦基础上加入十三度音，例如C13（C-E-G-Bb-D-F-A）</li>
                </ul>
                
                <p>在实际演奏中，扩展和弦通常会省略一些音，以避免音响过于复杂或浑浊。例如，十三和弦可能会省略十一度音，因为它与三度音可能产生不和谐音响。</p>
                
                <div class="chart-container" id="extended-chord-chart"></div>
            </section>

            <section id="special-chords">
                <h2>特殊和弦</h2>
                <p>除了标准的三和弦和七和弦外，音乐中还存在许多特殊结构的和弦，丰富了音乐表达的可能性：</p>
                
                <div class="chord-grid">
                    <div class="chord-card">
                        <h3>挂四和弦（sus4）</h3>
                        <p>挂四和弦将三音替换为四音，创造出一种悬而未决的感觉。</p>
                        <p>例如：Csus4（C-F-G）</p>
                    </div>
                    
                    <div class="chord-card">
                        <h3>挂二和弦（sus2）</h3>
                        <p>挂二和弦将三音替换为二音，产生一种开放、明亮的音色。</p>
                        <p>例如：Csus2（C-D-G）</p>
                    </div>
                    
                    <div class="chord-card">
                        <h3>加九和弦（add9）</h3>
                        <p>在三和弦上添加九度音，但不包含七度音。</p>
                        <p>例如：Cadd9（C-E-G-D）</p>
                    </div>
                    
                    <div class="chord-card">
                        <h3>六和弦（6th）</h3>
                        <p>在三和弦上添加六度音，常用于爵士和流行音乐。</p>
                        <p>例如：C6（C-E-G-A）</p>
                    </div>
                </div>
            </section>

            <section id="chord-progressions">
                <h2>和弦进行</h2>
                <p>和弦进行是指和弦按特定顺序连接形成的序列，是音乐创作的基础。不同的和弦进行可以创造出各种情感效果和音乐风格。以下是一些常见的和弦进行：</p>
                
                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                    <li><strong>I-IV-V</strong>：最基础的和弦进行，在流行、摇滚和民谣中极为常见</li>
                    <li><strong>I-V-vi-IV</strong>：流行音乐中最受欢迎的进行之一</li>
                    <li><strong>ii-V-I</strong>：爵士音乐中的标准进行</li>
                    <li><strong>I-vi-IV-V</strong>：50年代"心跳"进行，许多经典歌曲的基础</li>
                </ul>
                
                <div class="chart-container" id="progression-chart"></div>
                
                <p>和弦进行的魅力在于它能以不同的方式暗示和解决音乐中的紧张关系，从而创造出听众能够感知和欣赏的音乐叙述。</p>
            </section>

            <section id="quiz" class="quiz-container">
                <h2>和弦小测验</h2>
                <p>测试一下你对和弦类型的理解：</p>
                
                <div class="quiz-question">
                    <h3>问题：下列哪个和弦由根音、大三度和增五度组成？</h3>
                    <ul class="quiz-options">
                        <li class="quiz-option" data-correct="false">大三和弦</li>
                        <li class="quiz-option" data-correct="false">小三和弦</li>
                        <li class="quiz-option" data-correct="true">增三和弦</li>
                        <li class="quiz-option" data-correct="false">减三和弦</li>
                    </ul>
                </div>
                
                <div class="quiz-feedback correct">
                    <p>✓ 正确！增三和弦由根音、大三度（4个半音）和增五度（8个半音）构成，例如C-E-G#。</p>
                </div>
                
                <div class="quiz-feedback incorrect">
                    <p>✗ 不正确。增三和弦由根音、大三度（4个半音）和增五度（8个半音）构成，例如C-E-G#。</p>
                </div>
            </section>
        </div>
    </div>
    
    <script>
        // 初始化 ECharts 图表
        window.addEventListener('DOMContentLoaded', function() {
            // 和弦结构图表
            const chordStructureChart = echarts.init(document.getElementById('chord-structure-chart'));
            
            const chordStructureOption = {
                title: {
                    text: '和弦的音程结构',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c}'
                },
                series: [
                    {
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            fontSize: '16',
                            fontWeight: 'bold',
                            formatter: '{b}\n{d}%'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '18',
                                fontWeight: 'bold'
                            }
                        },
                        data: [
                            { value: 1, name: '根音', itemStyle: { color: '#3498db' } },
                            { value: 1, name: '三音', itemStyle: { color: '#e74c3c' } },
                            { value: 1, name: '五音', itemStyle: { color: '#2ecc71' } }
                        ]
                    }
                ]
            };
            
            chordStructureChart.setOption(chordStructureOption);
            
            // 三和弦比较图表
            const triadComparisonChart = echarts.init(document.getElementById('triad-comparison-chart'));
            
            const triadComparisonOption = {
                title: {
                    text: '四种基本三和弦的结构比较',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        let result = params[0].name + '<br/>';
                        params.forEach(param => {
                            result += param.marker + ' ' + param.seriesName + ': ' + param.value + ' 半音<br/>';
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['大三和弦', '小三和弦', '减三和弦', '增三和弦'],
                    top: 'bottom'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['根音到三音', '根音到五音'],
                    axisLabel: {
                        fontSize: 14
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '半音数',
                    nameLocation: 'middle',
                    nameGap: 40,
                    nameTextStyle: {
                        fontSize: 14
                    },
                    axisLabel: {
                        fontSize: 12
                    }
                },
                series: [
                    {
                        name: '大三和弦',
                        type: 'bar',
                        emphasis: {
                            focus: 'series'
                        },
                        data: [4, 7],
                        itemStyle: {
                            color: '#3498db'
                        }
                    },
                    {
                        name: '小三和弦',
                        type: 'bar',
                        emphasis: {
                            focus: 'series'
                        },
                        data: [3, 7],
                        itemStyle: {
                            color: '#e74c3c'
                        }
                    },
                    {
                        name: '减三和弦',
                        type: 'bar',
                        emphasis: {
                            focus: 'series'
                        },
                        data: [3, 6],
                        itemStyle: {
                            color: '#9b59b6'
                        }
                    },
                    {
                        name: '增三和弦',
                        type: 'bar',
                        emphasis: {
                            focus: 'series'
                        },
                        data: [4, 8],
                        itemStyle: {
                            color: '#f1c40f'
                        }
                    }
                ]
            };
            
            triadComparisonChart.setOption(triadComparisonOption);
            
            // 七和弦图表
            const seventhChordChart = echarts.init(document.getElementById('seventh-chord-chart'));
            
            const seventhChordOption = {
                title: {
                    text: '基本七和弦类型对比',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                legend: {
                    data: ['三音', '五音', '七音'],
                    top: 'bottom'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['大七和弦', '属七和弦', '小七和弦', '半减七和弦', '减七和弦'],
                    axisLabel: {
                        interval: 0,
                        rotate: 30
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '从根音的半音数',
                    nameLocation: 'middle',
                    nameGap: 40
                },
                series: [
                    {
                        name: '三音',
                        type: 'bar',
                        stack: 'chord',
                        emphasis: {
                            focus: 'series'
                        },
                        data: [4, 4, 3, 3, 3],
                        itemStyle: {
                            color: '#3498db'
                        }
                    },
                    {
                        name: '五音',
                        type: 'bar',
                        stack: 'chord',
                        emphasis: {
                            focus: 'series'
                        },
                        data: [3, 3, 4, 3, 3],
                        itemStyle: {
                            color: '#2ecc71'
                        }
                    },
                    {
                        name: '七音',
                        type: 'bar',
                        stack: 'chord',
                        emphasis: {
                            focus: 'series'
                        },
                        data: [4, 3, 3, 3, 2],
                        itemStyle: {
                            color: '#e74c3c'
                        }
                    }
                ]
            };
            
            seventhChordChart.setOption(seventhChordOption);
            
            // 扩展和弦图表
            const extendedChordChart = echarts.init(document.getElementById('extended-chord-chart'));
            
            const extendedChordOption = {
                title: {
                    text: '扩展和弦结构',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    top: 'bottom'
                },
                series: [
                    {
                        name: '构成音',
                        type: 'pie',
                        radius: ['30%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: '{b}\n{c}度'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '18',
                                fontWeight: 'bold'
                            }
                        },
                        labelLine: {
                            show: true
                        },
                        data: [
                            { value: 1, name: '根音', itemStyle: { color: '#3498db' } },
                            { value: 3, name: '三音', itemStyle: { color: '#e74c3c' } },
                            { value: 5, name: '五音', itemStyle: { color: '#2ecc71' } },
                            { value: 7, name: '七音', itemStyle: { color: '#9b59b6' } },
                            { value: 9, name: '九音', itemStyle: { color: '#f1c40f' } },
                            { value: 11, name: '十一音', itemStyle: { color: '#1abc9c' } },
                            { value: 13, name: '十三音', itemStyle: { color: '#e67e22' } }
                        ]
                    }
                ]
            };
            
            extendedChordChart.setOption(extendedChordOption);
            
            // 和弦进行图表
            const progressionChart = echarts.init(document.getElementById('progression-chart'));
            
            const progressionOption = {
                title: {
                    text: '常见和弦进行',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                legend: {
                    data: ['使用频率', '情感强度'],
                    top: 'bottom'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: [
                    {
                        type: 'category',
                        data: ['I-IV-V', 'I-V-vi-IV', 'ii-V-I', 'I-vi-IV-V', 'vi-IV-I-V'],
                        axisLabel: {
                            interval: 0,
                            rotate: 30
                        }
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        name: '使用频率',
                        min: 0,
                        max: 100,
                        interval: 20,
                        axisLabel: {
                            formatter: '{value}%'
                        }
                    },
                    {
                        type: 'value',
                        name: '情感强度',
                        min: 0,
                        max: 10,
                        interval: 2,
                        axisLabel: {
                            formatter: '{value}'
                        }
                    }
                ],
                series: [
                    {
                        name: '使用频率',
                        type: 'bar',
                        itemStyle: {
                            color: '#3498db'
                        },
                        data: [85, 90, 75, 65, 55]
                    },
                    {
                        name: '情感强度',
                        type: 'line',
                        yAxisIndex: 1,
                        symbol: 'circle',
                        symbolSize: 8,
                        lineStyle: {
                            width: 3
                        },
                        itemStyle: {
                            color: '#e74c3c'
                        },
                        data: [7, 8, 9, 7, 8]
                    }
                ]
            };
            
            progressionChart.setOption(progressionOption);
            
            // 响应式调整
            function resizeCharts() {
                chordStructureChart.resize();
                triadComparisonChart.resize();
                seventhChordChart.resize();
                extendedChordChart.resize();
                progressionChart.resize();
            }
            
            window.addEventListener('resize', resizeCharts);
            
            // 创建钢琴键盘
            function createPiano() {
                const piano = document.getElementById('triad-piano');
                piano.innerHTML = ''; // 清空现有内容
                
                // 创建白键和黑键
                const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B', 'C', 'D', 'E'];
                const blackKeys = ['C#', 'D#', '', 'F#', 'G#', 'A#', '', 'C#', 'D#'];
                
                // 添加白键
                for (let i = 0; i < whiteKeys.length; i++) {
                    const key = document.createElement('div');
                    key.className = 'piano-key white';
                    key.dataset.note = whiteKeys[i];
                    
                    const label = document.createElement('div');
                    label.className = 'key-label';
                    label.textContent = whiteKeys[i];
                    key.appendChild(label);
                    
                    piano.appendChild(key);
                    
                    // 给按键添加点击事件
                    key.addEventListener('click', function() {
                        highlightChord(this);
                    });
                }
                
                // 添加黑键
                for (let i = 0; i < blackKeys.length; i++) {
                    if (blackKeys[i]) {
                        const key = document.createElement('div');
                        key.className = 'piano-key black';
                        key.style.left = (i * 45 + 30) + 'px';
                        key.dataset.note = blackKeys[i];
                        
                        const label = document.createElement('div');
                        label.className = 'key-label';
                        label.textContent = blackKeys[i];
                        key.appendChild(label);
                        
                        piano.appendChild(key);
                        
                        // 给按键添加点击事件
                        key.addEventListener('click', function() {
                            highlightChord(this);
                        });
                    }
                }
                
                // 默认高亮C大三和弦
                highlightCMajorTriad();
            }
            
            // 高亮和弦
            function highlightChord(keyElement) {
                // 清除所有高亮
                const keys = document.querySelectorAll('.piano-key');
                keys.forEach(key => {
                    key.classList.remove('active');
                    key.classList.remove('highlight');
                });
                
                const note = keyElement.dataset.note;
                let chordNotes = [];
                
                // 根据点击的音符确定和弦
                if (note === 'C') {
                    // C大三和弦
                    chordNotes = ['C', 'E', 'G'];
                    document.getElementById('major-triad').scrollIntoView({ behavior: 'smooth' });
                } else if (note === 'D') {
                    // D小三和弦
                    chordNotes = ['D', 'F', 'A'];
                    document.getElementById('minor-triad').scrollIntoView({ behavior: 'smooth' });
                } else if (note === 'E') {
                    // E小三和弦
                    chordNotes = ['E', 'G', 'B'];
                    document.getElementById('minor-triad').scrollIntoView({ behavior: 'smooth' });
                } else if (note === 'F') {
                    // F大三和弦
                    chordNotes = ['F', 'A', 'C'];
                    document.getElementById('major-triad').scrollIntoView({ behavior: 'smooth' });
                } else if (note === 'G') {
                    // G大三和弦
                    chordNotes = ['G', 'B', 'D'];
                    document.getElementById('major-triad').scrollIntoView({ behavior: 'smooth' });
                } else if (note === 'A') {
                    // A小三和弦
                    chordNotes = ['A', 'C', 'E'];
                    document.getElementById('minor-triad').scrollIntoView({ behavior: 'smooth' });
                } else if (note === 'B') {
                    // B减三和弦
                    chordNotes = ['B', 'D', 'F'];
                    document.getElementById('diminished-triad').scrollIntoView({ behavior: 'smooth' });
                } else if (note === 'C#') {
                    // C#增三和弦（示例）
                    chordNotes = ['C#', 'F', 'A'];
                    document.getElementById('augmented-triad').scrollIntoView({ behavior: 'smooth' });
                }
                
                // 高亮选择的和弦音符
                keys.forEach(key => {
                    if (chordNotes.includes(key.dataset.note)) {
                        key.classList.add('active');
                    }
                });
                
                // 高亮根音
                keyElement.classList.add('highlight');
            }
            
            // 默认高亮C大三和弦
            function highlightCMajorTriad() {
                const keys = document.querySelectorAll('.piano-key');
                const chordNotes = ['C', 'E', 'G'];
                
                keys.forEach(key => {
                    if (key.dataset.note === 'C' && !key.classList.contains('black')) {
                        key.classList.add('highlight');
                    }
                    if (chordNotes.includes(key.dataset.note)) {
                        key.classList.add('active');
                    }
                });
            }
            
            createPiano();
            
            // 实现小测验功能
            const quizOptions = document.querySelectorAll('.quiz-option');
            const quizFeedbackCorrect = document.querySelector('.quiz-feedback.correct');
            const quizFeedbackIncorrect = document.querySelector('.quiz-feedback.incorrect');
            
            quizOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 清除之前的选择
                    quizOptions.forEach(opt => {
                        opt.classList.remove('correct', 'incorrect');
                    });
                    quizFeedbackCorrect.style.display = 'none';
                    quizFeedbackIncorrect.style.display = 'none';
                    
                    // 标记当前选择
                    const isCorrect = this.dataset.correct === 'true';
                    if (isCorrect) {
                        this.classList.add('correct');
                        quizFeedbackCorrect.style.display = 'block';
                    } else {
                        this.classList.add('incorrect');
                        quizFeedbackIncorrect.style.display = 'block';
                        // 找出正确答案并高亮
                        quizOptions.forEach(opt => {
                            if (opt.dataset.correct === 'true') {
                                opt.classList.add('correct');
                            }
                        });
                    }
                });
            });
            
            // 侧边栏活跃项跟踪
            const sections = document.querySelectorAll('section[id]');
            const tocLinks = document.querySelectorAll('.toc a');
            
            function highlightActiveTocItem() {
                let scrollPosition = window.scrollY;
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop - 100;
                    const sectionHeight = section.offsetHeight;
                    const sectionId = section.id;
                    
                    if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                        // 移除所有活跃类
                        tocLinks.forEach(link => {
                            link.parentElement.classList.remove('active');
                        });
                        
                        // 添加活跃类
                        const activeLink = document.querySelector(`.toc a[href="#${sectionId}"]`);
                        if (activeLink) {
                            activeLink.parentElement.classList.add('active');
                        }
                    }
                });
            }
            
            window.addEventListener('scroll', highlightActiveTocItem);
            highlightActiveTocItem(); // 初始运行
        });
    </script>
</body>
</html>