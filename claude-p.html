<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>和弦理论探索</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"></script>
    <style>
        :root {
            --primary: #2a3b4c;
            --secondary: #4a6c8c;
            --accent: #e67e22;
            --light: #f5f7fa;
            --dark: #1a1a2e;
            --text: #333;
            --text-light: #666;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Han Sans CN', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: linear-gradient(135deg, #f5f7fa 0%, #eef2f7 100%);
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        nav {
            width: 280px;
            background-color: var(--primary);
            color: white;
            padding: 1.5rem;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s;
        }
        
        .nav-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            font-weight: 500;
            letter-spacing: 0.05em;
        }
        
        .nav-list {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }
        
        .nav-link {
            display: block;
            padding: 0.5rem 0.75rem;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            border-radius: 0.375rem;
            transition: all 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            color: white;
            background-color: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }
        
        .nav-link.sub {
            padding-left: 1.5rem;
            font-size: 0.95rem;
        }
        
        main {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            margin-bottom: 3rem;
            text-align: center;
        }
        
        .title {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 1rem;
            letter-spacing: -0.03em;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            max-width: 700px;
            margin: 0 auto;
            font-weight: 400;
        }
        
        section {
            margin-bottom: 4rem;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            padding: 2rem;
            transition: all 0.3s;
        }
        
        section:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
        }
        
        h2 {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #eee;
            position: relative;
        }
        
        h2::after {
            content: "";
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 80px;
            height: 2px;
            background-color: var(--accent);
        }
        
        h3 {
            font-size: 1.4rem;
            color: var(--secondary);
            margin: 1.5rem 0 1rem;
        }
        
        p {
            margin-bottom: 1.2rem;
            line-height: 1.7;
        }
        
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: var(--accent);
            color: white;
            text-decoration: none;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            background-color: #d35400;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(230, 126, 34, 0.3);
        }
        
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 2rem 0;
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .card {
            background: #fff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border-top: 4px solid var(--accent);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        .card-title {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: var(--primary);
        }
        
        .piano {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            max-width: 100%;
            overflow-x: auto;
            padding: 1rem 0;
        }
        
        .key {
            position: relative;
            transition: all 0.1s;
        }
        
        .white-key {
            width: 40px;
            height: 150px;
            background: linear-gradient(to bottom, #fff 0%, #eee 100%);
            border: 1px solid #ccc;
            border-radius: 0 0 4px 4px;
            z-index: 1;
        }
        
        .black-key {
            width: 24px;
            height: 90px;
            background: linear-gradient(to bottom, #333 0%, #000 100%);
            position: absolute;
            margin-left: -12px;
            z-index: 2;
            border-radius: 0 0 3px 3px;
        }
        
        .key.active {
            background: var(--accent);
            transform: translateY(5px);
            box-shadow: none;
        }
        
        .white-key.active {
            background: linear-gradient(to bottom, #ffd599 0%, #ffbe6b 100%);
        }
        
        .black-key.active {
            background: linear-gradient(to bottom, #c26918 0%, #e67e22 100%);
        }
        
        .quiz-container {
            margin: 2rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 0.75rem;
            border-left: 5px solid var(--accent);
        }
        
        .quiz-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }
        
        .question {
            margin-bottom: 1.5rem;
        }
        
        .options {
            margin: 1rem 0;
        }
        
        .option {
            display: block;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option:hover {
            background: #f0f0f0;
        }
        
        .option.selected {
            background-color: #e0f0ff;
            border-color: #a0c8ff;
        }
        
        .option.correct {
            background-color: #e0ffe0;
            border-color: #a0ffa0;
        }
        
        .option.incorrect {
            background-color: #ffe0e0;
            border-color: #ffa0a0;
        }
        
        .feedback {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 0.5rem;
            display: none;
        }
        
        .feedback.success {
            background-color: #e0ffe0;
            color: #008000;
            display: block;
        }
        
        .feedback.error {
            background-color: #ffe0e0;
            color: #c00000;
            display: block;
        }
        
        .chord-player {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 2rem 0;
            gap: 1rem;
        }
        
        .chord-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .chord-btn {
            padding: 0.5rem 1rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chord-btn:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: 600;
            color: var(--primary);
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            nav {
                width: 100%;
                height: auto;
                position: relative;
                display: none;
            }
            
            main {
                padding: 1rem;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .card-grid {
                grid-template-columns: 1fr;
            }
            
            .piano {
                transform: scale(0.8);
                margin: 0 -2rem;
            }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f0f;
            position: absolute;
            top: 0;
            opacity: 0;
        }

        .progressive-highlight {
            background: linear-gradient(90deg, 
                rgba(230, 126, 34, 0.2) 0%, 
                rgba(230, 126, 34, 0.1) 50%, 
                rgba(0,0,0,0) 100%);
            padding: 0.2em 0.4em;
            border-radius: 0.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav id="sidebar">
            <div class="nav-title">和弦探索目录</div>
            <ul class="nav-list" id="toc">
                <li class="nav-item"><a href="#intro" class="nav-link">和弦简介</a></li>
                <li class="nav-item"><a href="#basic-types" class="nav-link">基本和弦类型</a></li>
                <li class="nav-item"><a href="#three-note" class="nav-link">三音和弦</a></li>
                <li class="nav-item"><a href="#four-note" class="nav-link">四音和弦</a></li>
                <li class="nav-item"><a href="#extended" class="nav-link">扩展和弦</a></li>
                <li class="nav-item"><a href="#altered" class="nav-link">变化和弦</a></li>
                <li class="nav-item"><a href="#borrowed" class="nav-link">借用和弦</a></li>
                <li class="nav-item"><a href="#nontertian" class="nav-link">非三度叠置和弦</a></li>
                <li class="nav-item"><a href="#practice" class="nav-link">听觉训练</a></li>
                <li class="nav-item"><a href="#quiz" class="nav-link">和弦小测验</a></li>
            </ul>
        </nav>
        
        <main>
            <div class="header">
                <h1 class="title">和弦的奥秘</h1>
                <p class="subtitle">探索音乐的基石，了解各类和弦的构成、种类和表现力</p>
            </div>
            
            <section id="intro">
                <h2>和弦简介</h2>
                <p>和弦是同时演奏的三个或更多不同音高的音的组合。它是西方音乐的基础构成要素之一，赋予音乐丰富的和声色彩和情感表达力。和弦在不同的音乐风格中扮演着核心角色，从古典音乐到流行音乐、爵士乐再到电子音乐，它们都离不开和弦的支撑。</p>
                
                <p>从技术角度来说，和弦是基于音程关系构建的。最常见的和弦构建方式是通过三度叠置（即每两个相邻音之间的关系是三度音程）。但和弦的种类远不止于此，不同的音程组合可以产生数以千计的不同和弦。</p>
                
                <div class="chord-player">
                    <h3>聆听基本和弦</h3>
                    <p>点击下方按钮聆听几种基本和弦的音色</p>
                    <div class="chord-controls">
                        <button class="chord-btn" onclick="playChord('C大三和弦', [60, 64, 67])">C大三和弦</button>
                        <button class="chord-btn" onclick="playChord('C小三和弦', [60, 63, 67])">C小三和弦</button>
                        <button class="chord-btn" onclick="playChord('C增三和弦', [60, 64, 68])">C增三和弦</button>
                        <button class="chord-btn" onclick="playChord('C减三和弦', [60, 63, 66])">C减三和弦</button>
                    </div>
                </div>
                
                <div class="piano" id="piano">
                    <!-- Piano keys will be generated by JavaScript -->
                </div>
            </section>
            
            <section id="basic-types">
                <h2>基本和弦类型</h2>
                <p>基于结构和功能，和弦可以分为许多不同的类型。以下是按照音符数量和结构组织的主要和弦类型：</p>
                
                <div class="chart-container" id="chord-types-chart"></div>
                
                <p>从构成音的数量来看，和弦可以分为：</p>
                <ul>
                    <li>双音和弦（二音和弦）：只包含两个音，技术上不算完整和弦，但在某些情境下仍被使用</li>
                    <li>三音和弦：包含三个不同的音，是最基本常见的和弦类型</li>
                    <li>四音和弦：包含四个不同的音，在爵士乐和现代音乐中广泛使用</li>
                    <li>扩展和弦：包含五个或更多的音，增加了和弦的色彩和复杂性</li>
                </ul>
            </section>
            
            <section id="three-note">
                <h2>三音和弦</h2>
                <p>三音和弦是最基础的和弦类型，由三个不同的音组成。根据构成音之间的音程关系，可以分为四种主要类型：</p>
                
                <div class="card-grid">
                    <div class="card">
                        <h3 class="card-title">大三和弦</h3>
                        <p>由根音、大三度和纯五度组成。</p>
                        <p>例如：C大三和弦（C-E-G）</p>
                        <p>特点：明亮、快乐、开放的音色</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">小三和弦</h3>
                        <p>由根音、小三度和纯五度组成。</p>
                        <p>例如：C小三和弦（C-E♭-G）</p>
                        <p>特点：忧郁、温暖、内敛的音色</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">增三和弦</h3>
                        <p>由根音、大三度和增五度组成。</p>
                        <p>例如：C增三和弦（C-E-G♯）</p>
                        <p>特点：紧张、不稳定、神秘的音色</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">减三和弦</h3>
                        <p>由根音、小三度和减五度组成。</p>
                        <p>例如：C减三和弦（C-E♭-G♭）</p>
                        <p>特点：忧伤、紧张、暗淡的音色</p>
                    </div>
                </div>
                
                <div class="chart-container" id="three-note-structure"></div>
                
                <p>在12个主要音上构建这四种三音和弦，理论上可以得到48种不同的三音和弦。但由于增三和弦的特殊结构（两个大三度叠加），实际上只有4种不同的增三和弦（其他都是这4种的重复变换）。</p>
            </section>
            
            <section id="four-note">
                <h2>四音和弦</h2>
                <p>四音和弦在三音和弦的基础上增加了一个音，通常是在最高音加上一个三度音程。这类和弦在爵士、流行和现代音乐中非常普遍。</p>
                
                <p>最常见的四音和弦包括：</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>和弦类型</th>
                            <th>构成</th>
                            <th>示例（C为根音）</th>
                            <th>音色特点</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>大七和弦</td>
                            <td>根音、大三度、纯五度、大七度</td>
                            <td>Cmaj7 (C-E-G-B)</td>
                            <td>明亮、稳定、优雅</td>
                        </tr>
                        <tr>
                            <td>属七和弦</td>
                            <td>根音、大三度、纯五度、小七度</td>
                            <td>C7 (C-E-G-B♭)</td>
                            <td>有张力、渴望解决</td>
                        </tr>
                        <tr>
                            <td>小七和弦</td>
                            <td>根音、小三度、纯五度、小七度</td>
                            <td>Cm7 (C-E♭-G-B♭)</td>
                            <td>柔和、忧郁、温暖</td>
                        </tr>
                        <tr>
                            <td>半减七和弦</td>
                            <td>根音、小三度、减五度、小七度</td>
                            <td>Cø7 (C-E♭-G♭-B♭)</td>
                            <td>不稳定、忧伤</td>
                        </tr>
                        <tr>
                            <td>减七和弦</td>
                            <td>根音、小三度、减五度、减七度</td>
                            <td>C°7 (C-E♭-G♭-A)</td>
                            <td>极度紧张、神秘</td>
                        </tr>
                        <tr>
                            <td>小大七和弦</td>
                            <td>根音、小三度、纯五度、大七度</td>
                            <td>CmM7 (C-E♭-G-B)</td>
                            <td>复杂、忧郁中带着亮色</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="chart-container" id="four-note-usage-chart"></div>
            </section>
            
            <section id="extended">
                <h2>扩展和弦</h2>
                <p>扩展和弦是通过在四音和弦的基础上继续添加三度叠置的音而形成的。最常见的扩展包括第9音、第11音和第13音：</p>
                
                <div class="progressive-highlight">
                    扩展和弦给予音乐更加丰富的色彩和表现力，在爵士乐、融合音乐以及现代作曲中被广泛应用。
                </div>
                
                <div class="card-grid">
                    <div class="card">
                        <h3 class="card-title">9和弦</h3>
                        <p>在7和弦基础上加入第9音（根音上方的大九度或小九度）</p>
                        <p>例如：C9 = C7+D (C-E-G-B♭-D)</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">11和弦</h3>
                        <p>在9和弦基础上加入第11音（根音上方的十一度）</p>
                        <p>例如：C11 = C9+F (C-E-G-B♭-D-F)</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">13和弦</h3>
                        <p>在11和弦基础上加入第13音（根音上方的十三度）</p>
                        <p>例如：C13 = C11+A (C-E-G-B♭-D-F-A)</p>
                    </div>
                </div>
                
                <p>实际演奏中，扩展和弦可能会省略某些音以避免音响过于拥挤，但和弦的功能特征仍然保留。</p>
            </section>
            
            <section id="altered">
                <h2>变化和弦</h2>
                <p>变化和弦是指对标准和弦的某些音进行升高或降低而形成的和弦。这些变化增加了和声的色彩和复杂性，在爵士乐和现代音乐中尤为重要。</p>
                
                <p>常见的变化包括：</p>
                <ul>
                    <li><strong>增5度或减5度</strong>：例如C7♯5或C7♭5，通过改变和弦的第5音</li>
                    <li><strong>增9度或减9度</strong>：例如C7♯9或C7♭9，通过改变和弦的第9音</li>
                    <li><strong>增11度</strong>：例如C7♯11，通过升高和弦的第11音</li>
                    <li><strong>Alt和弦</strong>：包含多种升降音的复杂变化和弦，如C7alt可能包含♭9、♯9、♯11、♭13等变化音</li>
                </ul>
                
                <div class="chart-container" id="altered-chord-chart"></div>
                
                <p>变化和弦极大地扩展了和声语言的表现力，为作曲家和即兴演奏者提供了更多情感表达的可能性。</p>
            </section>
            
            <section id="borrowed">
                <h2>借用和弦</h2>
                <p>借用和弦是指从调式的平行大调或小调中借用的和弦。例如，C大调中可以借用c小调中的和弦，这种技巧可以增加和声的变化性和表现力。</p>
                
                <p>借用和弦的主要类型包括：</p>
                <ul>
                    <li><strong>调式混合借用</strong>：从平行大小调中借用和弦</li>
                    <li><strong>那不勒斯和弦</strong>：小调中降II级大三和弦</li>
                    <li><strong>增六和弦</strong>：包括意大利增六和弦、法国增六和弦和德国增六和弦</li>
                </ul>
                
                <p>借用和弦为音乐增添了戏剧性和情感深度，在古典音乐、电影配乐和流行音乐中都有广泛应用。</p>
            </section>
            
            <section id="nontertian">
                <h2>非三度叠置和弦</h2>
                <p>虽然大多数常见和弦是通过三度叠置形成的，但也存在一些基于其他音程关系的和弦类型：</p>
                
                <div class="card-grid">
                    <div class="card">
                        <h3 class="card-title">挂四和弦</h3>
                        <p>用第4音代替第3音的和弦</p>
                        <p>例如：Csus4 (C-F-G)</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">挂二和弦</h3>
                        <p>用第2音代替第3音的和弦</p>
                        <p>例如：Csus2 (C-D-G)</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">叠四和弦</h3>
                        <p>由完全四度叠置形成的和弦</p>
                        <p>例如：C quartal (C-F-B♭)</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">叠五和弦</h3>
                        <p>由完全五度叠置形成的和弦</p>
                        <p>例如：C quintal (C-G-D)</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">簇音和弦</h3>
                        <p>由小二度或大二度等小音程叠加的和弦</p>
                        <p>例如：C-C♯-D簇音和弦</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title">多调性和弦</h3>
                        <p>结合两个或多个不同调的和弦元素</p>
                        <p>例如：C和E♭三和弦叠置</p>
                    </div>
                </div>
                
                <p>这些非传统和弦结构在当代音乐、爵士、前卫摇滚和电影音乐中被广泛应用，创造出独特的声音色彩。</p>
            </section>
            
            <section id="practice">
                <h2>听觉训练：辨识和弦</h2>
                <p>和弦辨识是音乐训练中的重要技能。以下是一个简单的交互式工具，帮助你练习辨识不同类型的和弦。</p>
                
                <div class="chord-player">
                    <h3>听并辨识</h3>
                    <p>点击"播放"按钮，然后尝试辨识所播放的和弦类型</p>
                    <div class="chord-controls">
                        <button class="btn" id="play-random">播放随机和弦</button>
                    </div>
                    <div id="chord-options" style="margin-top: 1rem; display: none;">
                        <button class="chord-btn" onclick="checkChord('major')">大三和弦</button>
                        <button class="chord-btn" onclick="checkChord('minor')">小三和弦</button>
                        <button class="chord-btn" onclick="checkChord('augmented')">增三和弦</button>
                        <button class="chord-btn" onclick="checkChord('diminished')">减三和弦</button>
                        <button class="chord-btn" onclick="checkChord('dominant7')">属七和弦</button>
                        <button class="chord-btn" onclick="checkChord('major7')">大七和弦</button>
                    </div>
                    <div id="feedback" style="margin-top: 1rem; display: none;"></div>
                </div>
            </section>
            
            <section id="quiz">
                <h2>和弦小测验</h2>
                <div class="quiz-container">
                    <h3 class="quiz-title">测试你对和弦的理解</h3>
                    <div class="question">
                        <p>下列哪个和弦包含三个大三度音程的叠置？</p>
                        <div class="options">
                            <div class="option" onclick="selectOption(this, 1)">增三和弦</div>
                            <div class="option" onclick="selectOption(this, 2)">属七和弦</div>
                            <div class="option" onclick="selectOption(this, 3)">增减七和弦（Augmented major seventh）</div>
                        </div>
                    </div>
                    <div id="quiz-feedback" class="feedback"></div>
                    <button class="btn" id="check-answer" style="display: none;">检查答案</button>
                </div>
            </section>
        </main>
    </div>
    
    <script>
        // 把侧边栏设置为粘性定位
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const navLinks = document.querySelectorAll('.nav-link');
            
            // 监听滚动事件，高亮当前可见的段落对应的导航链接
            window.addEventListener('scroll', function() {
                const scrollPosition = window.scrollY;
                
                document.querySelectorAll('section').forEach(section => {
                    const sectionTop = section.offsetTop - 100;
                    const sectionBottom = sectionTop + section.offsetHeight;
                    const id = section.getAttribute('id');
                    
                    if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                        navLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === '#' + id) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            });
            
            // 如果是移动设备，隐藏侧边栏
            if (window.innerWidth <= 768) {
                sidebar.style.display = 'none';
            }
            
            // 为导航链接添加点击事件
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768) {
                        sidebar.style.display = 'none';
                    }
                    
                    // 平滑滚动到对应章节
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    window.scrollTo({
                        top: targetElement.offsetTop - 20,
                        behavior: 'smooth'
                    });
                });
            });
        });
        
        // 创建钢琴键盘
        function createPiano() {
            const pianoElement = document.getElementById('piano');
            const notes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
            const octave = 4; // 中央C所在的八度
            
            // 清空钢琴元素
            pianoElement.innerHTML = '';
            
            // 创建一个八度的钢琴键盘
            for (let i = 0; i < notes.length; i++) {
                const whiteKey = document.createElement('div');
                whiteKey.className = 'key white-key';
                whiteKey.dataset.note = notes[i] + octave;
                pianoElement.appendChild(whiteKey);
                
                // 添加黑键（C#, D#, F#, G#, A#）
                if (notes[i] !== 'E' && notes[i] !== 'B') {
                    const blackKey = document.createElement('div');
                    blackKey.className = 'key black-key';
                    blackKey.dataset.note = notes[i] + '#' + octave;
                    pianoElement.appendChild(blackKey);
                }
            }
            
            // 再添加高八度的C
            const highC = document.createElement('div');
            highC.className = 'key white-key';
            highC.dataset.note = 'C' + (octave + 1);
            pianoElement.appendChild(highC);
        }
        
        // 初始化音符播放
        let currentChord = null;
        
        // 播放和弦的函数
        function playChord(chordName, midiNotes) {
            console.log(`Playing ${chordName}: [${midiNotes.join(', ')}]`);
            
            // 如果当前有高亮的键，先移除高亮
            const activeKeys = document.querySelectorAll('.key.active');
            activeKeys.forEach(key => key.classList.remove('active'));
            
            // 创建音符
            let sounds = [];
            midiNotes.forEach(midi => {
                // 获取音符名称
                const noteName = getNoteName(midi);
                // 找到对应的键
                const key = document.querySelector(`.key[data-note="${noteName}"]`);
                if (key) {
                    key.classList.add('active');
                }
                
                // 添加音符到播放列表
                sounds.push(new Howl({
                    src: [`https://tonejs.github.io/audio/salamander/C${midi % 12 + 4}.mp3`],
                    volume: 0.7,
                    onend: function() {
                        // 音符播放结束后移除高亮
                        if (key) {
                            setTimeout(() => key.classList.remove('active'), 300);
                        }
                    }
                }));
            });
            
            // 播放所有音符
            sounds.forEach(sound => sound.play());
            
            return sounds;
        }
        
        // 将MIDI音符转换为音符名称
        function getNoteName(midiNote) {
            const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            const octave = Math.floor(midiNote / 12) - 1;
            const noteName = noteNames[midiNote % 12];
            return noteName + octave;
        }
        
        // 和弦定义
        const chords = {
            'major': [60, 64, 67], // C-E-G
            'minor': [60, 63, 67], // C-Eb-G
            'augmented': [60, 64, 68], // C-E-G#
            'diminished': [60, 63, 66], // C-Eb-Gb
            'dominant7': [60, 64, 67, 70], // C-E-G-Bb
            'major7': [60, 64, 67, 71] // C-E-G-B
        };
        
        // 听音练习逻辑
        let currentChordType = null;
        
        document.getElementById('play-random').addEventListener('click', function() {
            // 随机选择一个和弦类型
            const chordTypes = Object.keys(chords);
            currentChordType = chordTypes[Math.floor(Math.random() * chordTypes.length)];
            
            // 播放和弦
            playChord(currentChordType, chords[currentChordType]);
            
            // 显示选项
            document.getElementById('chord-options').style.display = 'block';
            document.getElementById('feedback').style.display = 'none';
        });
        
        function checkChord(selectedChord) {
            const feedbackElement = document.getElementById('feedback');
            
            if (selectedChord === currentChordType) {
                feedbackElement.textContent = '正确! 这是一个' + getChordDisplayName(currentChordType) + '。';
                feedbackElement.className = 'feedback success';
            } else {
                feedbackElement.textContent = '不对，这是一个' + getChordDisplayName(currentChordType) + '。请再试一次！';
                feedbackElement.className = 'feedback error';
            }
            
            feedbackElement.style.display = 'block';
            
            // 显示正确和弦的名称并再次播放
            setTimeout(() => {
                playChord(currentChordType, chords[currentChordType]);
            }, 1000);
        }
        
        function getChordDisplayName(chordType) {
            const displayNames = {
                'major': '大三和弦',
                'minor': '小三和弦',
                'augmented': '增三和弦',
                'diminished': '减三和弦',
                'dominant7': '属七和弦',
                'major7': '大七和弦'
            };
            return displayNames[chordType] || chordType;
        }
        
        // 测验逻辑
        let selectedOption = null;
        
        function selectOption(element, optionNumber) {
            // 移除所有选项的选中状态
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // 设置当前选项为选中状态
            element.classList.add('selected');
            selectedOption = optionNumber;
            
            // 显示检查答案按钮
            document.getElementById('check-answer').style.display = 'block';
        }
        
        document.getElementById('check-answer').addEventListener('click', function() {
            if (selectedOption === null) return;
            
            const options = document.querySelectorAll('.option');
            const feedbackElement = document.getElementById('quiz-feedback');
            
            // 正确答案是第3个选项
            for (let i = 0; i < options.length; i++) {
                options[i].classList.remove('selected');
                if (i + 1 === 3) { // 正确答案
                    options[i].classList.add('correct');
                } else if (i + 1 === selectedOption) {
                    options[i].classList.add('incorrect');
                }
            }
            
            if (selectedOption === 3) {
                feedbackElement.textContent = '正确! 增减七和弦（如C-E-G#-B）包含三个大三度音程的叠置。';
                feedbackElement.className = 'feedback success';
                createConfetti();
            } else {
                feedbackElement.textContent = '不正确。增减七和弦（如C-E-G#-B）包含三个大三度音程的叠置。';
                feedbackElement.className = 'feedback error';
            }
            
            this.style.display = 'none';
        });
        
        // 创建五彩纸屑效果
        function createConfetti() {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animation = `fall ${Math.random() * 3 + 2}s linear forwards`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(confetti);
                
                // 定义动画
                const style = document.createElement('style');
                style.innerHTML = `
                    @keyframes fall {
                        0% {
                            transform: translateY(0) rotate(0);
                            opacity: 1;
                        }
                        100% {
                            transform: translateY(100vh) rotate(${Math.random() * 720 - 360}deg);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
                
                // 动画结束后移除元素
                setTimeout(() => {
                    confetti.remove();
                    style.remove();
                }, (Math.random() * 3 + 2) * 1000);
            }
        }
        
        // 初始化图表
        function initCharts() {
            // 和弦类型图表
            const chordTypesChart = echarts.init(document.getElementById('chord-types-chart'));
            const chordTypesOption = {
                title: {
                    text: '和弦类型概览',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item'
                },
                series: [
                    {
                        name: '和弦类型',
                        type: 'pie',
                        radius: ['30%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: '{b}: {c}'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '18',
                                fontWeight: 'bold'
                            }
                        },
                        data: [
                            { value: 4, name: '三音和弦' },
                            { value: 7, name: '四音和弦' },
                            { value: 12, name: '扩展和弦' },
                            { value: 8, name: '变化和弦' },
                            { value: 6, name: '非三度叠置和弦' }
                        ]
                    }
                ]
            };
            chordTypesChart.setOption(chordTypesOption);
            
            // 三音和弦结构图表
            const threeNoteChart = echarts.init(document.getElementById('three-note-structure'));
            const threeNoteOption = {
                title: {
                    text: '三音和弦的结构比较',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: '{b}: {c}半音'
                },
                legend: {
                    data: ['第三音到根音的距离', '第五音到第三音的距离'],
                    bottom: '0'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['大三和弦', '小三和弦', '增三和弦', '减三和弦']
                },
                yAxis: {
                    type: 'value',
                    name: '半音数',
                    axisLabel: {
                        formatter: '{value}'
                    }
                },
                series: [
                    {
                        name: '第三音到根音的距离',
                        type: 'bar',
                        data: [4, 3, 4, 3],
                        itemStyle: {
                            color: '#e67e22'
                        }
                    },
                    {
                        name: '第五音到第三音的距离',
                        type: 'bar',
                        data: [3, 4, 4, 3],
                        itemStyle: {
                            color: '#2a3b4c'
                        }
                    }
                ]
            };
            threeNoteChart.setOption(threeNoteOption);
            
            // 四音和弦使用频率图表
            const fourNoteChart = echarts.init(document.getElementById('four-note-usage-chart'));
            const fourNoteOption = {
                title: {
                    text: '四音和弦在现代音乐中的使用频率',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: [
                    {
                        type: 'category',
                        data: ['属七', '小七', '大七', '半减七', '减七', '小大七'],
                        axisTick: {
                            alignWithLabel: true
                        }
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        name: '相对使用频率',
                        max: 100
                    }
                ],
                series: [
                    {
                        name: '使用频率',
                        type: 'bar',
                        barWidth: '60%',
                        data: [90, 80, 65, 40, 30, 20],
                        itemStyle: {
                            color: function(params) {
                                const colorList = ['#e67e22', '#2a3b4c', '#4a6c8c', '#8e44ad', '#16a085', '#c0392b'];
                                return colorList[params.dataIndex];
                            }
                        }
                    }
                ]
            };
            fourNoteChart.setOption(fourNoteOption);
            
            // 变化和弦图表
            const alteredChordChart = echarts.init(document.getElementById('altered-chord-chart'));
            const alteredChordOption = {
                title: {
                    text: '变化和弦中常见的音程变化',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item'
                },
                radar: {
                    indicator: [
                        { name: '♭5/♯5', max: 100 },
                        { name: '♭9/♯9', max: 100 },
                        { name: '♭13', max: 100 },
                        { name: '♯11', max: 100 },
                        { name: '♭7/♮7', max: 100 }
                    ]
                },
                series: [
                    {
                        name: '变化和弦频率分布',
                        type: 'radar',
                        data: [
                            {
                                value: [80, 70, 60, 65, 85],
                                name: '爵士乐',
                                areaStyle: {
                                    color: 'rgba(230, 126, 34, 0.4)'
                                },
                                lineStyle: {
                                    color: '#e67e22'
                                },
                                itemStyle: {
                                    color: '#e67e22'
                                }
                            },
                            {
                                value: [60, 50, 30, 40, 70],
                                name: '流行音乐',
                                areaStyle: {
                                    color: 'rgba(42, 59, 76, 0.4)'
                                },
                                lineStyle: {
                                    color: '#2a3b4c'
                                },
                                itemStyle: {
                                    color: '#2a3b4c'
                                }
                            }
                        ]
                    }
                ]
            };
            alteredChordChart.setOption(alteredChordOption);
            
            // 窗口大小变化时调整图表大小
            window.addEventListener('resize', function() {
                chordTypesChart.resize();
                threeNoteChart.resize();
                fourNoteChart.resize();
                alteredChordChart.resize();
            });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            createPiano();
            initCharts();
        });
    </script>
</body>
</html>