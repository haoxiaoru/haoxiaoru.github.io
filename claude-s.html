<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>和弦理论探索</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
    <style>
        :root {
            --primary: #2a3f54;
            --secondary: #ef7c00;
            --light: #f8f9fa;
            --dark: #212529;
            --accent: #6c5ce7;
            --text: #333;
            --background: #f5f8fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding: 0;
            margin: 0;
        }
        
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }
        
        .sidebar {
            width: 280px;
            position: sticky;
            top: 0;
            height: 100vh;
            padding: 2rem 0.5rem;
            background: var(--primary);
            color: white;
            overflow-y: auto;
            transition: all 0.3s;
            border-right: 3px solid var(--secondary);
        }
        
        .sidebar a {
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            padding: 0.5rem 1rem;
            display: block;
            border-radius: 4px;
            margin-bottom: 0.25rem;
            transition: all 0.2s;
        }
        
        .sidebar a:hover, .sidebar a.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .sub-link {
            padding-left: 2rem;
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .content {
            flex: 1;
            padding: 2rem;
            max-width: 100%;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
            border-bottom: 3px solid var(--secondary);
            padding-bottom: 0.5rem;
        }
        
        h2 {
            font-size: 1.8rem;
            margin: 2rem 0 1rem;
            color: var(--primary);
        }
        
        h3 {
            font-size: 1.4rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--primary);
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 2rem 0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: white;
        }
        
        .piano-container {
            margin: 2rem 0;
            overflow-x: auto;
        }
        
        .piano {
            display: flex;
            height: 150px;
            min-width: 700px;
            position: relative;
            margin: 0 auto;
        }
        
        .white-key {
            flex: 1;
            background: white;
            border: 1px solid #ccc;
            border-radius: 0 0 4px 4px;
            position: relative;
            z-index: 1;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .white-key.active {
            background-color: #e3f2fd;
        }
        
        .black-key {
            width: 60%;
            height: 60%;
            background: #333;
            position: absolute;
            z-index: 2;
            border-radius: 0 0 4px 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .black-key.active {
            background-color: #555;
        }
        
        .key-name {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-weight: bold;
        }
        
        .chord-display {
            margin: 1rem 0;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
        }
        
        .chord-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0 2rem;
            justify-content: center;
        }
        
        .chord-btn {
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chord-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .note-circle {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: rgba(239, 124, 0, 0.8);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
            z-index: 10;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .note-circle.visible {
            opacity: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: var(--primary);
            color: white;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .quiz-container {
            margin: 3rem 0;
            padding: 2rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-title {
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .quiz-question {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            font-weight: bold;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin: 1rem 0;
        }
        
        .quiz-option {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quiz-option:hover {
            background-color: #f5f5f5;
        }
        
        .quiz-option.selected {
            border-color: var(--accent);
            background-color: rgba(108, 92, 231, 0.1);
        }
        
        .quiz-option.correct {
            border-color: #2ecc71;
            background-color: rgba(46, 204, 113, 0.1);
        }
        
        .quiz-option.incorrect {
            border-color: #e74c3c;
            background-color: rgba(231, 76, 60, 0.1);
        }
        
        .quiz-feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 6px;
            display: none;
        }
        
        .quiz-feedback.correct {
            background-color: rgba(46, 204, 113, 0.1);
            color: #27ae60;
            display: block;
        }
        
        .quiz-feedback.incorrect {
            background-color: rgba(231, 76, 60, 0.1);
            color: #c0392b;
            display: block;
        }
        
        .submit-btn {
            padding: 0.75rem 1.5rem;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .submit-btn:hover {
            background-color: #5549d6;
            transform: translateY(-2px);
        }
        
        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .reward {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            pointer-events: none;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f39c12;
            border-radius: 50%;
            animation: fall 3s linear forwards;
            opacity: 0;
        }
        
        @keyframes fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh)) rotate(360deg);
                opacity: 0;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                display: none;
            }
            
            .content {
                padding: 1.5rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <a href="#intro">和弦基础介绍</a>
            <a href="#definition" class="sub-link">和弦定义</a>
            <a href="#structure" class="sub-link">和弦结构</a>
            <a href="#types">和弦类型</a>
            <a href="#triad" class="sub-link">三和弦</a>
            <a href="#seventh" class="sub-link">七和弦</a>
            <a href="#extended" class="sub-link">扩展和弦</a>
            <a href="#altered" class="sub-link">变化和弦</a>
            <a href="#special" class="sub-link">特殊和弦</a>
            <a href="#notation">和弦标记法</a>
            <a href="#interactive">互动和弦演示</a>
            <a href="#relations">和弦关系</a>
            <a href="#progressions">常见和弦进行</a>
            <a href="#quiz">和弦知识小测验</a>
        </div>
        
        <div class="content">
            <h1>和弦理论探索</h1>
            
            <section id="intro">
                <h2>和弦基础介绍</h2>
                <p>和弦是音乐中最基本的和声结构，是将三个或更多不同音高的音按照特定的结构同时或相继发声所形成的组合。和弦是构建音乐和声的基础单元，为音乐作品提供了结构支撑和情感表达的核心元素。</p>
                
                <div id="chord-intro-chart" class="chart-container"></div>
                
                <h3 id="definition">和弦定义</h3>
                <p>从技术角度看，和弦是由至少三个不同的音高组成的音的集合。这些音按照特定的间隔关系（通常是以三度音程叠置）组合在一起，形成和声整体。和弦可以在任何乐器上演奏，包括钢琴、吉他、管弦乐队等。</p>
                
                <h3 id="structure">和弦结构</h3>
                <p>和弦的结构主要由以下要素决定：</p>
                <ul>
                    <li><strong>根音</strong>：和弦的基础音，和弦通常以根音命名</li>
                    <li><strong>音程关系</strong>：和弦中各音之间的距离关系</li>
                    <li><strong>音数</strong>：和弦包含的音的数量</li>
                    <li><strong>排列方式</strong>：和弦中音的排列顺序，影响和弦的转位</li>
                </ul>
            </section>
            
            <section id="types">
                <h2>和弦类型</h2>
                <p>音乐理论中存在多种类型的和弦，按照结构可以分为以下几大类：</p>
                
                <h3 id="triad">三和弦</h3>
                <p>三和弦是最基本的和弦类型，由三个音组成，通常是根音、三度音和五度音。根据三度音和五度音的性质，三和弦可分为四种基本类型：</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>三和弦类型</th>
                            <th>结构</th>
                            <th>音程关系</th>
                            <th>C为根音示例</th>
                            <th>情感特点</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>大三和弦</td>
                            <td>根音-大三度-纯五度</td>
                            <td>大三度+小三度</td>
                            <td>C-E-G</td>
                            <td>明亮、稳定、愉悦</td>
                        </tr>
                        <tr>
                            <td>小三和弦</td>
                            <td>根音-小三度-纯五度</td>
                            <td>小三度+大三度</td>
                            <td>C-E♭-G</td>
                            <td>忧郁、柔和、沉思</td>
                        </tr>
                        <tr>
                            <td>增三和弦</td>
                            <td>根音-大三度-增五度</td>
                            <td>大三度+大三度</td>
                            <td>C-E-G♯</td>
                            <td>紧张、不稳定、神秘</td>
                        </tr>
                        <tr>
                            <td>减三和弦</td>
                            <td>根音-小三度-减五度</td>
                            <td>小三度+小三度</td>
                            <td>C-E♭-G♭</td>
                            <td>阴暗、不安、焦虑</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3 id="seventh">七和弦</h3>
                <p>七和弦在三和弦的基础上加入七度音，形成四音和弦。常见的七和弦类型有：</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>七和弦类型</th>
                            <th>结构</th>
                            <th>C为根音示例</th>
                            <th>常见应用</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>大七和弦 (Cmaj7)</td>
                            <td>大三和弦+大七度</td>
                            <td>C-E-G-B</td>
                            <td>爵士乐、流行音乐中的柔和和声</td>
                        </tr>
                        <tr>
                            <td>属七和弦 (C7)</td>
                            <td>大三和弦+小七度</td>
                            <td>C-E-G-B♭</td>
                            <td>蓝调音乐、和声中的支配功能</td>
                        </tr>
                        <tr>
                            <td>小七和弦 (Cm7)</td>
                            <td>小三和弦+小七度</td>
                            <td>C-E♭-G-B♭</td>
                            <td>爵士乐、流行音乐中的内向情感</td>
                        </tr>
                        <tr>
                            <td>半减七和弦 (Cm7♭5)</td>
                            <td>减三和弦+小七度</td>
                            <td>C-E♭-G♭-B♭</td>
                            <td>次属和弦、过渡和声</td>
                        </tr>
                        <tr>
                            <td>减七和弦 (C°7)</td>
                            <td>减三和弦+减七度</td>
                            <td>C-E♭-G♭-B♭♭</td>
                            <td>古典音乐中的紧张转调</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3 id="extended">扩展和弦</h3>
                <p>扩展和弦在基础和弦上继续叠加更高的音，包括九和弦、十一和弦和十三和弦：</p>
                <ul>
                    <li><strong>九和弦</strong>：七和弦+九度音（例如：C9 = C-E-G-B♭-D）</li>
                    <li><strong>十一和弦</strong>：九和弦+十一度音（例如：C11 = C-E-G-B♭-D-F）</li>
                    <li><strong>十三和弦</strong>：十一和弦+十三度音（例如：C13 = C-E-G-B♭-D-F-A）</li>
                </ul>
                
                <div id="extended-chords-chart" class="chart-container"></div>
                
                <h3 id="altered">变化和弦</h3>
                <p>变化和弦是通过改变和弦中某个或多个音得到的和弦变体：</p>
                <ul>
                    <li><strong>增六和弦</strong>：意大利增六、法国增六、德国增六和弦</li>
                    <li><strong>变化七和弦</strong>：如C7(♭9)、C7(♯11)等</li>
                    <li><strong>挂留和弦</strong>：如Csus4 (C-F-G)和Csus2 (C-D-G)</li>
                </ul>
                
                <h3 id="special">特殊和弦</h3>
                <p>一些不遵循常规三度堆叠结构的和弦：</p>
                <ul>
                    <li><strong>加六和弦</strong>：如C6 (C-E-G-A)</li>
                    <li><strong>多音和弦</strong>：包含4个或更多相邻音的和弦</li>
                    <li><strong>分数和弦</strong>：如C/E（在E低音上的C和弦）</li>
                    <li><strong>空五和弦</strong>：只包含根音和五度音，如C5 (C-G)</li>
                </ul>
            </section>
            
            <section id="notation">
                <h2>和弦标记法</h2>
                <p>和弦标记法是一种简写系统，用于表示和弦结构和功能。不同音乐传统和地区可能使用稍有不同的标记系统：</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>和弦类型</th>
                            <th>通用标记</th>
                            <th>欧洲/古典标记</th>
                            <th>流行/爵士标记</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>C大三和弦</td>
                            <td>C</td>
                            <td>C dur</td>
                            <td>C</td>
                        </tr>
                        <tr>
                            <td>C小三和弦</td>
                            <td>Cm</td>
                            <td>c moll</td>
                            <td>Cmin, C-</td>
                        </tr>
                        <tr>
                            <td>C属七和弦</td>
                            <td>C7</td>
                            <td>C7</td>
                            <td>C7</td>
                        </tr>
                        <tr>
                            <td>C大七和弦</td>
                            <td>Cmaj7</td>
                            <td>CΔ7</td>
                            <td>CM7, CΔ</td>
                        </tr>
                    </tbody>
                </table>
            </section>
            
            <section id="interactive">
                <h2>互动和弦演示</h2>
                <p>选择一个和弦类型，在下方钢琴上查看和听取不同和弦的结构和声音：</p>
                
                <div class="chord-buttons">
                    <button class="chord-btn" data-chord="C">C大三和弦</button>
                    <button class="chord-btn" data-chord="Cm">C小三和弦</button>
                    <button class="chord-btn" data-chord="Cdim">C减三和弦</button>
                    <button class="chord-btn" data-chord="Caug">C增三和弦</button>
                    <button class="chord-btn" data-chord="C7">C属七和弦</button>
                    <button class="chord-btn" data-chord="Cmaj7">C大七和弦</button>
                    <button class="chord-btn" data-chord="Cm7">C小七和弦</button>
                </div>
                
                <div class="chord-display" id="chord-display">选择一个和弦查看</div>
                
                <div class="piano-container">
                    <div class="piano" id="piano">
                        <!-- 钢琴键将通过JS动态生成 -->
                    </div>
                </div>
            </section>
            
            <section id="relations">
                <h2>和弦关系</h2>
                <p>和弦之间存在多种关系，这些关系构成了音乐中和声进行的基础：</p>
                <ul>
                    <li><strong>功能和声关系</strong>：主和弦(I)、属和弦(V)和下属和弦(IV)的关系</li>
                    <li><strong>调式内关系</strong>：同一个调式中和弦之间的关系</li>
                    <li><strong>调性转换关系</strong>：不同调式间和弦的关联</li>
                </ul>
                <div id="chord-relations-chart" class="chart-container"></div>
            </section>
            
            <section id="progressions">
                <h2>常见和弦进行</h2>
                <p>和弦进行是一系列和弦的连接，它们形成音乐中的和声框架。以下是一些最常见的和弦进行：</p>
                <ul>
                    <li><strong>I-IV-V-I</strong>：最基础的古典和声进行</li>
                    <li><strong>I-V-vi-IV</strong>：流行音乐中极其常见的进行</li>
                    <li><strong>ii-V-I</strong>：爵士乐中的标准进行</li>
                    <li><strong>I-vi-IV-V</strong>：50年代流行的"心痛进行"</li>
                    <li><strong>vi-IV-I-V</strong>："安达卢西亚下降"进行</li>
                </ul>
            </section>
            
            <section id="quiz" class="quiz-container">
                <h2 class="quiz-title">和弦知识小测验</h2>
                <div class="quiz-question">问题：以下哪个和弦是由根音、小三度和纯五度构成的？</div>
                <div class="quiz-options">
                    <div class="quiz-option" data-value="a">A. 大三和弦 (Major triad)</div>
                    <div class="quiz-option" data-value="b">B. 小三和弦 (Minor triad)</div>
                    <div class="quiz-option" data-value="c">C. 增三和弦 (Augmented triad)</div>
                    <div class="quiz-option" data-value="d">D. 减三和弦 (Diminished triad)</div>
                </div>
                <button class="submit-btn" id="submit-quiz">提交答案</button>
                <div id="quiz-feedback" class="quiz-feedback"></div>
            </section>
        </div>
    </div>
    
    <div class="reward" id="reward"></div>

    <script>
        // 初始化侧边栏滚动监听
        document.addEventListener('DOMContentLoaded', function() {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.sidebar a');
            
            window.addEventListener('scroll', function() {
                let current = '';
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    if (scrollY >= sectionTop - 200) {
                        current = section.getAttribute('id');
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${current}`) {
                        link.classList.add('active');
                    }
                });
            });
        });
        
        // 初始化ECharts图表
        document.addEventListener('DOMContentLoaded', function() {
            // 和弦类型介绍图
            const chordIntroChart = echarts.init(document.getElementById('chord-intro-chart'));
            const chordIntroOption = {
                title: {
                    text: '常见和弦类型分布',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 10,
                    data: ['三和弦', '七和弦', '扩展和弦', '变化和弦', '特殊和弦']
                },
                series: [
                    {
                        name: '和弦类型',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '18',
                                fontWeight: 'bold'
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: [
                            { value: 35, name: '三和弦' },
                            { value: 30, name: '七和弦' },
                            { value: 15, name: '扩展和弦' },
                            { value: 12, name: '变化和弦' },
                            { value: 8, name: '特殊和弦' }
                        ]
                    }
                ]
            };
            chordIntroChart.setOption(chordIntroOption);
            
            // 扩展和弦复杂度图表
            const extendedChordsChart = echarts.init(document.getElementById('extended-chords-chart'));
            const extendedChordsOption = {
                title: {
                    text: '和弦复杂度与表现力关系',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                legend: {
                    data: ['和弦中的音数', '表现力评分', '复杂度'],
                    top: 30
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['三和弦', '七和弦', '九和弦', '十一和弦', '十三和弦']
                },
                yAxis: {
                    type: 'value'
                },
                series: [
                    {
                        name: '和弦中的音数',
                        type: 'bar',
                        data: [3, 4, 5, 6, 7]
                    },
                    {
                        name: '表现力评分',
                        type: 'line',
                        data: [65, 78, 85, 90, 95]
                    },
                    {
                        name: '复杂度',
                        type: 'line',
                        data: [30, 55, 75, 88, 98]
                    }
                ]
            };
            extendedChordsChart.setOption(extendedChordsOption);
            
            // 和弦关系图
            const chordRelationsChart = echarts.init(document.getElementById('chord-relations-chart'));
            const chordRelationsOption = {
                title: {
                    text: 'C大调中的和弦功能关系',
                    left: 'center'
                },
                tooltip: {},
                animationDurationUpdate: 1500,
                animationEasingUpdate: 'quinticInOut',
                series: [
                    {
                        type: 'graph',
                        layout: 'circular',
                        symbolSize: 50,
                        roam: true,
                        label: {
                            show: true
                        },
                        edgeSymbol: ['circle', 'arrow'],
                        edgeSymbolSize: [4, 10],
                        edgeLabel: {
                            fontSize: 12
                        },
                        data: [
                            {
                                name: 'I (C)',
                                value: 'C-E-G',
                                category: 0,
                                symbolSize: 70,
                                itemStyle: {
                                    color: '#2a3f54'
                                }
                            },
                            {
                                name: 'IV (F)',
                                value: 'F-A-C',
                                category: 1,
                                symbolSize: 60
                            },
                            {
                                name: 'V (G)',
                                value: 'G-B-D',
                                category: 1,
                                symbolSize: 60
                            },
                            {
                                name: 'ii (Dm)',
                                value: 'D-F-A',
                                category: 2
                            },
                            {
                                name: 'iii (Em)',
                                value: 'E-G-B',
                                category: 2
                            },
                            {
                                name: 'vi (Am)',
                                value: 'A-C-E',
                                category: 2
                            },
                            {
                                name: 'vii° (Bdim)',
                                value: 'B-D-F',
                                category: 2
                            }
                        ],
                        links: [
                            {
                                source: 'I (C)',
                                target: 'IV (F)',
                                label: {
                                    show: true,
                                    formatter: '主-下属'
                                }
                            },
                            {
                                source: 'IV (F)',
                                target: 'V (G)',
                                label: {
                                    show: true,
                                    formatter: '下属-属'
                                }
                            },
                            {
                                source: 'V (G)',
                                target: 'I (C)',
                                label: {
                                    show: true,
                                    formatter: '属-主'
                                }
                            },
                            {
                                source: 'I (C)',
                                target: 'vi (Am)',
                                label: {
                                    show: true,
                                    formatter: '关系小调'
                                }
                            },
                            {
                                source: 'ii (Dm)',
                                target: 'V (G)',
                                label: {
                                    show: true,
                                    formatter: '前导'
                                }
                            },
                            {
                                source: 'vii° (Bdim)',
                                target: 'I (C)',
                                label: {
                                    show: true,
                                    formatter: '导音'
                                }
                            }
                        ],
                        lineStyle: {
                            opacity: 0.9,
                            width: 2,
                            curveness: 0.3
                        }
                    }
                ]
            };
            chordRelationsChart.setOption(chordRelationsOption);
            
            // 响应窗口大小变化重绘图表
            window.addEventListener('resize', function() {
                chordIntroChart.resize();
                extendedChordsChart.resize();
                chordRelationsChart.resize();
            });
        });
        
        // 钢琴和和弦交互
        document.addEventListener('DOMContentLoaded', function() {
            const piano = document.getElementById('piano');
            const chordDisplay = document.getElementById('chord-display');
            
            // 定义钢琴键的信息
            const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
            const blackKeys = ['C#', 'D#', 'F#', 'G#', 'A#'];
            const blackKeyPositions = [0, 1, 3, 4, 5]; // 对应于白键的索引
            
            // 和弦定义
            const chords = {
                'C': ['C', 'E', 'G'],
                'Cm': ['C', 'D#', 'G'], // E♭表示为D#
                'Cdim': ['C', 'D#', 'F#'], // E♭和G♭
                'Caug': ['C', 'E', 'G#'],
                'C7': ['C', 'E', 'G', 'A#'], // B♭表示为A#
                'Cmaj7': ['C', 'E', 'G', 'B'],
                'Cm7': ['C', 'D#', 'G', 'A#'] // E♭和B♭
            };
            
            // 音频上下文
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            
            // 创建钢琴键盘
            function createPiano() {
                // 先清空钢琴
                piano.innerHTML = '';
                
                // 创建一个八度的白键
                for (let i = 0; i < whiteKeys.length; i++) {
                    const key = document.createElement('div');
                    key.className = 'white-key';
                    key.dataset.note = whiteKeys[i];
                    
                    const keyName = document.createElement('div');
                    keyName.className = 'key-name';
                    keyName.textContent = whiteKeys[i];
                    key.appendChild(keyName);
                    
                    piano.appendChild(key);
                }
                
                // 创建黑键
                for (let i = 0; i < blackKeyPositions.length; i++) {
                    const key = document.createElement('div');
                    key.className = 'black-key';
                    key.dataset.note = blackKeys[i];
                    
                    // 定位黑键
                    const position = blackKeyPositions[i];
                    const whiteKeyWidth = 100 / whiteKeys.length;
                    key.style.left = `${position * whiteKeyWidth + whiteKeyWidth / 2}%`;
                    key.style.width = `${whiteKeyWidth * 0.6}%`;
                    
                    piano.appendChild(key);
                }
            }
            
            // 演奏单个音符
            function playNote(note, duration = 1) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // 频率映射
                const frequencies = {
                    'C': 261.63,
                    'C#': 277.18,
                    'D': 293.66,
                    'D#': 311.13,
                    'E': 329.63,
                    'F': 349.23,
                    'F#': 369.99,
                    'G': 392.00,
                    'G#': 415.30,
                    'A': 440.00,
                    'A#': 466.16,
                    'B': 493.88
                };
                
                oscillator.frequency.value = frequencies[note];
                oscillator.type = 'sine';
                
                const now = audioContext.currentTime;
                
                // 音量包络
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.6, now + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
                
                oscillator.start(now);
                oscillator.stop(now + duration);
                
                return { oscillator, gainNode };
            }
            
            // 演奏和弦
            function playChord(chordNotes, staggered = false) {
                const duration = staggered ? 2 : 1.5;
                const oscillators = [];
                
                chordNotes.forEach((note, index) => {
                    const delay = staggered ? index * 0.15 : 0;
                    setTimeout(() => {
                        const { oscillator, gainNode } = playNote(note, duration - delay);
                        oscillators.push({ oscillator, gainNode });
                    }, delay * 1000);
                });
                
                // 高亮显示按键
                highlightKeys(chordNotes);
                
                return oscillators;
            }
            
            // 高亮显示按键
            function highlightKeys(notes) {
                // 先清除所有高亮
                document.querySelectorAll('.white-key, .black-key').forEach(key => {
                    key.classList.remove('active');
                });
                
                // 设置新高亮
                notes.forEach(note => {
                    const key = document.querySelector(`.white-key[data-note="${note}"], .black-key[data-note="${note}"]`);
                    if (key) {
                        key.classList.add('active');
                    }
                });
                
                // 显示音符圆点
                showNoteCircles(notes);
            }
            
            // 显示音符圆点
            function showNoteCircles(notes) {
                // 先清除所有音符圆点
                document.querySelectorAll('.note-circle').forEach(circle => {
                    circle.remove();
                });
                
                // 为每个音符创建圆点
                notes.forEach((note, index) => {
                    const key = document.querySelector(`.white-key[data-note="${note}"], .black-key[data-note="${note}"]`);
                    if (key) {
                        const rect = key.getBoundingClientRect();
                        const pianoRect = piano.getBoundingClientRect();
                        
                        const circle = document.createElement('div');
                        circle.className = 'note-circle';
                        circle.textContent = index + 1;
                        
                        // 计算圆点位置 - 在钢琴键上方
                        const isBlackKey = key.classList.contains('black-key');
                        const x = rect.left + rect.width / 2 - pianoRect.left;
                        const y = isBlackKey ? rect.top + rect.height / 2 - pianoRect.top : rect.top + rect.height / 3 - pianoRect.top;
                        
                        circle.style.left = `${x}px`;
                        circle.style.top = `${y}px`;
                        
                        piano.appendChild(circle);
                        
                        // 淡入动画
                        setTimeout(() => {
                            circle.classList.add('visible');
                        }, 10);
                    }
                });
            }
            
            // 将和弦名称转换为更友好的显示格式
            function formatChordName(chordKey) {
                const chordDisplayNames = {
                    'C': 'C大三和弦 (C Major)',
                    'Cm': 'C小三和弦 (C Minor)',
                    'Cdim': 'C减三和弦 (C Diminished)',
                    'Caug': 'C增三和弦 (C Augmented)',
                    'C7': 'C属七和弦 (C Dominant 7th)',
                    'Cmaj7': 'C大七和弦 (C Major 7th)',
                    'Cm7': 'C小七和弦 (C Minor 7th)'
                };
                
                return chordDisplayNames[chordKey] || chordKey;
            }
            
            // 和弦按钮点击事件
            function setupChordButtons() {
                document.querySelectorAll('.chord-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const chordKey = this.dataset.chord;
                        const chordNotes = chords[chordKey];
                        
                        // 更新显示
                        chordDisplay.textContent = formatChordName(chordKey) + ' - ' + chordNotes.join(', ');
                        
                        // 播放和弦
                        playChord(chordNotes, true);
                    });
                });
            }
            
            // 初始化钢琴和按钮
            createPiano();
            setupChordButtons();
            
            // 测验部分
            const quizOptions = document.querySelectorAll('.quiz-option');
            const submitBtn = document.getElementById('submit-quiz');
            const quizFeedback = document.getElementById('quiz-feedback');
            const rewardContainer = document.getElementById('reward');
            
            let selectedOption = null;
            
            quizOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 清除之前的选择
                    quizOptions.forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // 标记新选择
                    this.classList.add('selected');
                    selectedOption = this.dataset.value;
                });
            });
            
            submitBtn.addEventListener('click', function() {
                if (!selectedOption) return;
                
                const correctAnswer = 'b'; // 小三和弦
                
                quizOptions.forEach(option => {
                    if (option.dataset.value === correctAnswer) {
                        option.classList.add('correct');
                    } else if (option.dataset.value === selectedOption && selectedOption !== correctAnswer) {
                        option.classList.add('incorrect');
                    }
                });
                
                if (selectedOption === correctAnswer) {
                    quizFeedback.className = 'quiz-feedback correct';
                    quizFeedback.textContent = '正确！小三和弦由根音、小三度和纯五度构成，例如C-E♭-G。';
                    createConfetti();
                } else {
                    quizFeedback.className = 'quiz-feedback incorrect';
                    quizFeedback.textContent = '不正确。小三和弦由根音、小三度和纯五度构成，例如C-E♭-G。';
                }
                
                this.disabled = true;
            });
            
            // 创建庆祝动画
            function createConfetti() {
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    // 随机位置
                    const startX = Math.random() * window.innerWidth;
                    
                    // 随机颜色
                    const colors = ['#ef7c00', '#2a3f54', '#6c5ce7', '#00cec9', '#e84393', '#fdcb6e'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    confetti.style.left = `${startX}px`;
                    confetti.style.top = '-10px';
                    confetti.style.backgroundColor = color;
                    
                    // 随机大小
                    const size = Math.random() * 8 + 4;
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    
                    // 随机动画延迟
                    confetti.style.animationDelay = `${Math.random() * 2}s`;
                    
                    rewardContainer.appendChild(confetti);
                    
                    // 动画结束后移除
                    confetti.addEventListener('animationend', function() {
                        this.remove();
                    });
                }
            }
        });
    </script>
</body>
</html>